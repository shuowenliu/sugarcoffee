<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>æ­Œæ›²ç®¡ç†ç³»çµ±</title>
  <style>
    body { font-family: sans-serif; margin: 0; display: flex; height: 100vh; }
    .left { flex: 2; padding: 20px; overflow: auto; border-right: 1px solid #ccc; }
    .right { flex: 1; padding: 20px; }
    table { width: 100%; border-collapse: collapse; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { cursor: pointer; background: #f5f5f5; }
    .pagination { margin-top: 10px; text-align: center; }
    button { margin: 2px; padding: 6px 12px; }
    input, select { width: 100%; padding: 6px; margin: 4px 0; }
  </style>
</head>
<body>
  <!-- å·¦é‚Šï¼šæ­Œæ›²æ¸…å–® -->
  <div class="left">
    <h2>ğŸµ æ­Œæ›²æ¸…å–®</h2>
    <input type="text" id="search" placeholder="æœå°‹..." oninput="render()" />
    <table>
      <thead>
        <tr>
          <th onclick="sortBy('name')">æ­Œå</th>
          <th onclick="sortBy('bpm')">é€Ÿåº¦</th>
          <th onclick="sortBy('lang')">èªè¨€</th>
          <th onclick="sortBy('style')">å‹æ…‹</th>
          <th>æ“ä½œ</th>
        </tr>
      </thead>
      <tbody id="songTable"></tbody>
    </table>
    <div class="pagination" id="pagination"></div>
  </div>

  <!-- å³é‚Šï¼šæ–°å¢ / ç·¨è¼¯ -->
  <div class="right">
    <h2>âœï¸ æ–°å¢ / ç·¨è¼¯æ­Œæ›²</h2>
    <input type="hidden" id="songId">
    <p><input id="songName" placeholder="æ­Œå"></p>
    <p><input id="songBpm" type="number" placeholder="BPM"></p>
    <p>
      <select id="songLang">
        <option>ä¸­æ–‡</option>
        <option>è‹±æ–‡</option>
        <option>æ—¥æ–‡</option>
        <option>éŸ“æ–‡</option>
        <option>è¶Šå—</option>
        <option>ç²µèª</option>
        <option>å°èª</option>
      </select>
    </p>
    <p>
      <select id="songStyle">
        <option>æƒ…æ­Œ</option>
        <option>æ‚²å‚·</option>
        <option>å—¨æ­Œ</option>
        <option>RAP</option>
        <option>æŠ’æƒ…</option>
      </select>
    </p>
    <button onclick="saveSong()">ğŸ’¾ å„²å­˜</button>
    <button onclick="clearForm()">ğŸ§¹ æ¸…é™¤</button>
  </div>

  <script>
    let songs = [];
    let currentPage = 1;
    const pageSize = 10;
    let sortKey = '';
    let sortAsc = true;

    function loadSongs() {
      google.script.run.withSuccessHandler(data => {
        songs = data;
        render();
      }).getSongs();
    }

    function saveSong() {
      const song = {
        id: document.getElementById("songId").value,
        name: document.getElementById("songName").value,
        bpm: parseInt(document.getElementById("songBpm").value) || 0,
        lang: document.getElementById("songLang").value,
        style: document.getElementById("songStyle").value
      };
      if (!song.name) return alert("è«‹è¼¸å…¥æ­Œå");

      google.script.run.withSuccessHandler(result => {
        if (result.status === "ok") {
          clearForm();
          loadSongs();
        }
      }).saveSong(song);
    }

    function editSong(id) {
      const song = songs.find(s => s.id === id);
      if (!song) return;
      document.getElementById("songId").value = song.id;
      document.getElementById("songName").value = song.name;
      document.getElementById("songBpm").value = song.bpm;
      document.getElementById("songLang").value = song.lang;
      document.getElementById("songStyle").value = song.style;
    }

    function deleteSong(id) {
      if (!confirm("ç¢ºå®šè¦åˆªé™¤å—ï¼Ÿ")) return;
      google.script.run.withSuccessHandler(result => {
        if (result.status === "ok") loadSongs();
      }).deleteSong(id);
    }

    function clearForm() {
      document.getElementById("songId").value = "";
      document.getElementById("songName").value = "";
      document.getElementById("songBpm").value = "";
      document.getElementById("songLang").value = "ä¸­æ–‡";
      document.getElementById("songStyle").value = "æƒ…æ­Œ";
    }

    function render() {
      const search = document.getElementById("search").value.toLowerCase();
      let filtered = songs.filter(s =>
        s.name.toLowerCase().includes(search) ||
        s.lang.toLowerCase().includes(search) ||
        s.style.toLowerCase().includes(search)
      );

      if (sortKey) {
        filtered.sort((a, b) => {
          if (a[sortKey] < b[sortKey]) return sortAsc ? -1 : 1;
          if (a[sortKey] > b[sortKey]) return sortAsc ? 1 : -1;
          return 0;
        });
      }

      const totalPages = Math.ceil(filtered.length / pageSize);
      if (currentPage > totalPages) currentPage = totalPages || 1;
      const start = (currentPage - 1) * pageSize;
      const pageData = filtered.slice(start, start + pageSize);

      const tbody = document.getElementById("songTable");
      tbody.innerHTML = "";
      pageData.forEach(s => {
        const row = `<tr>
          <td>${s.name}</td>
          <td>${s.bpm}</td>
          <td>${s.lang}</td>
          <td>${s.style}</td>
          <td>
            <button onclick="editSong('${s.id}')">âœï¸ ç·¨è¼¯</button>
            <button onclick="deleteSong('${s.id}')">ğŸ—‘ åˆªé™¤</button>
          </td>
        </tr>`;
        tbody.insertAdjacentHTML("beforeend", row);
      });

      const pagination = document.getElementById("pagination");
      pagination.innerHTML = "";
      for (let i = 1; i <= totalPages; i++) {
        pagination.innerHTML += `<button onclick="gotoPage(${i})" ${i === currentPage ? "disabled" : ""}>${i}</button>`;
      }
    }

    function sortBy(key) {
      if (sortKey === key) sortAsc = !sortAsc;
      else { sortKey = key; sortAsc = true; }
      render();
    }

    function gotoPage(page) {
      currentPage = page;
      render();
    }

    window.onload = loadSongs;
  </script>
</body>
</html>
