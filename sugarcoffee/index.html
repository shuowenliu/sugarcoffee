<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>æ‰¹æ¬¡åŒ¯å…¥æ­Œæ›²</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f7f7f7; }
    h2 { color: #333; }
    .log { background: #fff; padding: 10px; border: 1px solid #ccc; height: 300px; overflow-y: auto; white-space: pre-line; }
    input[type="file"] { margin-bottom: 10px; }
    button { padding: 8px 16px; margin-top: 10px; }
  </style>
</head>
<body>
  <h2>ğŸµ æ‰¹æ¬¡åŒ¯å…¥æ­Œæ›²</h2>
  <input type="file" id="fileInput" accept=".csv" />
  <button onclick="importCSV()">é–‹å§‹åŒ¯å…¥</button>
  <div class="log" id="log"></div>

  <script>
    const API_URL = "https://script.google.com/macros/s/AKfycbzF2TiPXvC5Wc9Qka2mQ1H3SSGzxCV_LDFBK6YXN-GdxMKqFrpEWrC1kvhPK72JnZd1Jg/exec";

    function log(msg) {
      document.getElementById("log").innerText += msg + "\n";
    }

    async function importCSV() {
      const file = document.getElementById("fileInput").files[0];
      if (!file) return alert("è«‹å…ˆé¸æ“‡ CSV æª”æ¡ˆï¼");
      
      const text = await file.text();
      const rows = text.split("\n").map(r => r.split(",").map(v => v.trim())).filter(r => r.length >= 4);
      
      log(`è®€å–åˆ° ${rows.length - 1} ç­†è³‡æ–™ï¼Œé–‹å§‹åŒ¯å…¥...\n`);
      for (let i = 1; i < rows.length; i++) { // è·³éè¡¨é ­
        const [name, bpm, lang, style] = rows[i];
        if (!name) continue;

        const song = { id: "", name, bpm: parseInt(bpm) || 0, lang, style };

        try {
          const res = await fetch(API_URL, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ action: "saveSong", song })
          });
          const result = await res.json();

          if (result.status === "ok") {
            log(`âœ… æ–°å¢æˆåŠŸï¼š${name} (${lang}/${style})`);
          } else if (result.status === "duplicate") {
            log(`âš ï¸ è·³éé‡è¤‡ï¼š${name}`);
          } else {
            log(`âŒ å¤±æ•—ï¼š${name} (${JSON.stringify(result)})`);
          }
        } catch (e) {
          log(`âŒ éŒ¯èª¤ï¼š${name} (${e.message})`);
        }
      }
      log("\nğŸ‰ åŒ¯å…¥å®Œæˆï¼");
    }
  </script>
</body>
</html>
