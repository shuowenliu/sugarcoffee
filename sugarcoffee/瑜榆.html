// 更新紀錄顯示格式，依照階段分區塊顯示，並用進度條表示完成度

function updateUI() {
  plantSeed.disabled = state.seeded;
  water.disabled = !(state.seeded && state.nextAction === 'water');
  dust.disabled = !(state.seeded && state.nextAction === 'dust');

  if (!state.seeded) {
    status.innerText = '請先下種子';
  } else {
    status.innerText = `目前為第 ${state.stage + 1} 階段，第 ${Math.floor(state.progress / 2) + 1} 次 ${state.nextAction === 'water' ? '澆水' : '除塵'}`;
  }

  if (state.log.length === 0) {
    logDiv.innerHTML = '<p>尚無紀錄</p>';
    return;
  }

  const stages = [[], [], [], []];
  [...state.log].reverse().forEach(entry => {
    if (stages[entry.stage]) stages[entry.stage].push(entry);
  });

  let html = '';
  stages.forEach((entries, index) => {
    if (entries.length === 0) return;
    html += `<h4>第 ${index + 1} 階段</h4>`;
    html += '<table><thead><tr><th>動作</th><th>次數</th><th>時間</th></tr></thead><tbody>';
    entries.forEach(entry => {
      html += `<tr><td>${entry.action}</td><td>第 ${entry.count} 次</td><td>${entry.time}</td></tr>`;
    });
    html += '</tbody></table>';

    const total = stageLimits[index] * 2;
    const current = entries.length;
    const percent = Math.min(100, Math.round((current / total) * 100));
    html += `<div style="background:#eee;border-radius:12px;height:12px;margin-top:5px;"><div style="width:${percent}%;background:#f99;height:12px;border-radius:12px;"></div></div>`;
  });

  logDiv.innerHTML = html;
}
