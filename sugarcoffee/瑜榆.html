<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>愛心種植計畫</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #fef3e7;
      color: #5a5a5a;
      text-align: center;
      padding: 20px;
    }

    h1 {
      font-size: 2em;
      color: #d2691e;
    }

    .stage-info {
      font-size: 1.2em;
      margin-top: 20px;
      color: #333;
    }

    .btn-container {
      margin-top: 30px;
    }

    button {
      padding: 10px 20px;
      font-size: 1em;
      background-color: #ffcc66;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      margin: 10px;
      transition: background-color 0.3s;
    }

    button:hover {
      background-color: #ff9966;
    }

    .status {
      margin-top: 20px;
      font-size: 1.1em;
      color: #444;
    }

    .clear-btn {
      margin-top: 20px;
      background-color: #ff6666;
      color: white;
    }

    .clear-btn:hover {
      background-color: #ff4d4d;
    }

  </style>
</head>
<body>

  <h1>愛心種植計畫</h1>

  <div id="stage-info" class="stage-info">
    <!-- 階段和次數顯示會在這裡更新 -->
  </div>

  <div class="btn-container">
    <button id="plant-seed" onclick="plantSeed()">下種子</button>
    <button id="water" onclick="performAction('water')" disabled>澆水</button>
    <button id="dust" onclick="performAction('dust')" disabled>除塵</button>
  </div>

  <div class="status" id="status-message">
    <!-- 顯示狀態訊息 -->
  </div>

  <button class="clear-btn" onclick="clearProgress()">清除紀錄</button>

  <script>
    // 種植計畫的數據
    let stage = 0;  // 當前階段
    let wateringCount = 0;  // 當前澆水次數
    let dustingCount = 0;  // 當前除塵次數
    let seedPlanted = false;  // 是否已經下過種子
    let actionPending = false;  // 是否需要等待另一個動作（澆水除塵交替）
    let actionTime = '';  // 儲存每次動作的時間

    // 定義每個階段的需求
    const stageRequirements = [
      { watering: 1, dusting: 1 },
      { watering: 1, dusting: 1 },
      { watering: 5, dusting: 5 },
      { watering: 9, dusting: 9 }
    ];

    // 初始化頁面
    window.onload = function() {
      loadProgress();
    }

    // 設置當前階段、澆水、除塵次數
    function updateStageInfo() {
      const stageText = stage === 0 ? "尚未開始" :
                        stage === 1 ? "第一階段" :
                        stage === 2 ? "第二階段" :
                        stage === 3 ? "第三階段" : "第四階段";

      const wateringRequired = stageRequirements[stage].watering;
      const dustingRequired = stageRequirements[stage].dusting;

      document.getElementById("stage-info").textContent = 
        `當前階段：${stageText}，澆水：${wateringCount}/${wateringRequired}，除塵：${dustingCount}/${dustingRequired}`;

      if (actionTime) {
        document.getElementById("status-message").textContent = `最新動作時間：${actionTime}`;
      }
    }

    // 載入進度
    function loadProgress() {
      const savedData = JSON.parse(localStorage.getItem("plantProgress"));

      if (savedData) {
        stage = savedData.stage;
        wateringCount = savedData.wateringCount;
        dustingCount = savedData.dustingCount;
        seedPlanted = savedData.seedPlanted;
      }

      updateStageInfo();
      toggleButtons();
    }

    // 儲存進度
    function saveProgress() {
      const progressData = {
        stage: stage,
        wateringCount: wateringCount,
        dustingCount: dustingCount,
        seedPlanted: seedPlanted
      };
      localStorage.setItem("plantProgress", JSON.stringify(progressData));
    }

    // 執行澆水或除塵的動作
    function performAction(action) {
      if (!seedPlanted) {
        alert("請先下種子！");
        return;
      }

      // 當前需要交替的動作
      const currentTime = new Date().toLocaleString();
      if (action === 'water' && wateringCount < stageRequirements[stage].watering) {
        wateringCount++;
        actionTime = `澆水時間：${currentTime}`;
        actionPending = true;
        saveProgress();
        updateStageInfo();

        // 完成澆水後等待除塵
        if (wateringCount === stageRequirements[stage].watering) {
          alert("已完成澆水，請進行除塵！");
          toggleButtons();
        }
      } 
      else if (action === 'dust' && dustingCount < stageRequirements[stage].dusting) {
        dustingCount++;
        actionTime = `除塵時間：${currentTime}`;
        actionPending = false;
        saveProgress();
        updateStageInfo();

        // 完成除塵後進入下一階段
        if (dustingCount === stageRequirements[stage].dusting) {
          stage++;
          if (stage < 4) {
            alert("已完成本階段，進入下一階段！");
          } else {
            alert("恭喜！你已完成所有階段！");
          }
          wateringCount = 0;
          dustingCount = 0;
          saveProgress();
          updateStageInfo();
          toggleButtons();
        }
      }

      toggleButtons();
    }

    // 更新按鈕的啟用狀態
    function toggleButtons() {
      if (stage === 0) {
        document.getElementById("plant-seed").disabled = false;
        document.getElementById("water").disabled = true;
        document.getElementById("dust").disabled = true;
      } else if (stage >= 1 && stage <= 3) {
        document.getElementById("water").disabled = actionPending || wateringCount >= stageRequirements[stage].watering;
        document.getElementById("dust").disabled = !actionPending || dustingCount >= stageRequirements[stage].dusting;
      } else {
        document.getElementById("water").disabled = true;
        document.getElementById("dust").disabled = true;
      }
    }

    // 下種子
    function plantSeed() {
      if (seedPlanted) {
        alert("已經下過種子，無法再次下種！");
        return;
      }

      seedPlanted = true;
      stage = 1;
      wateringCount = 0;
      dustingCount = 0;
      actionPending = true;
      saveProgress();
      updateStageInfo();
      toggleButtons();
    }

    // 清除紀錄
    function clearProgress() {
      localStorage.removeItem("plantProgress");
      stage = 0;
      wateringCount = 0;
      dustingCount = 0;
      seedPlanted = false;
      actionPending = false;
      saveProgress();
      updateStageInfo();
      toggleButtons();
    }

  </script>
</body>
</html>
