<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>ğŸµ GGL æ­Œæ›²ç®¡ç†</title>
  <style>
    body { font-family: "Microsoft JhengHei", sans-serif; background: #222; color: #eee; padding: 20px; }
    h2 { color: #ffcc00; }
    input, select { padding: 6px; margin: 4px; border: none; border-radius: 5px; background: #444; color: #fff; }
    button { padding: 8px 14px; margin: 4px; border: none; border-radius: 5px; cursor: pointer; background: #ffcc00; color: #000; font-weight: bold; }
    button:hover { background: #ffaa00; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { padding: 8px; text-align: center; border-bottom: 1px solid #555; }
    th { color: #ffcc00; }
    tr:hover { background: #444; }
  </style>
</head>
<body>
  <h2>ğŸ“‹ GGL æ­Œæ›²æ¸…å–®</h2>
  <table>
    <thead>
      <tr>
        <th>æ­Œå</th>
        <th>BPM</th>
        <th>èªè¨€</th>
        <th>å‹æ…‹</th>
        <th>æ“ä½œ</th>
      </tr>
    </thead>
    <tbody id="songTable"></tbody>
  </table>

  <h2>âœï¸ æ–°å¢ / ç·¨è¼¯æ­Œæ›²</h2>
  <input type="hidden" id="songId">
  <p><input id="songName" placeholder="æ­Œå"></p>
  <p><input id="songBpm" type="number" placeholder="BPM"></p>
  <p>
    <select id="songLang">
      <option>ä¸­æ–‡</option>
      <option>è‹±æ–‡</option>
      <option>æ—¥æ–‡</option>
      <option>éŸ“æ–‡</option>
    </select>
  </p>
  <p>
    <select id="songStyle">
      <option>æƒ…æ­Œ</option>
      <option>æ‚²å‚·</option>
      <option>å—¨æ­Œ</option>
      <option>RAP</option>
    </select>
  </p>
  <button id="saveSongBtn">ğŸ’¾ å„²å­˜</button>
  <button id="clearFormBtn">ğŸ§¹ æ¸…é™¤</button>

  <!-- è¼‰å…¥ Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    let songs = [];

    // â­ Supabase è¨­å®š
    const SUPABASE_URL = 'https://qcvkwglzltebvajvyakm.supabase.co';
    const SUPABASE_KEY = 'ä½ çš„ anon key'; // âš ï¸ è¨˜å¾—æ›æ‰
    const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    // ğŸš€ è¼‰å…¥æ­Œæ›²
    async function loadSongs() {
      const { data, error } = await supabaseClient.from('ranked_songs').select('*');
      if (error) {
        console.error('è¼‰å…¥æ­Œæ›²å¤±æ•—:', error);
        alert('è¼‰å…¥æ­Œæ›²å¤±æ•—ï¼Œè«‹æª¢æŸ¥ Supabase è¨­å®šï¼');
      } else {
        songs = data || [];
        render();
      }
    }

    // å„²å­˜æ­Œæ›²
    async function saveSong() {
      const songId = document.getElementById("songId").value;
      const songName = document.getElementById("songName").value.trim();
      const songBpm = parseInt(document.getElementById("songBpm").value) || 0;
      const songLang = document.getElementById("songLang").value;
      const songStyle = document.getElementById("songStyle").value;
      if (!songName) return alert("è«‹è¼¸å…¥æ­Œå");

      const newSong = { name: songName, bpm: songBpm, lang: songLang, style: songStyle };

      let result;
      if (songId) {
        result = await supabaseClient.from('ranked_songs').update(newSong).eq('id', songId);
      } else {
        result = await supabaseClient.from('ranked_songs').insert(newSong);
      }

      if (result.error) alert('å„²å­˜å¤±æ•—ï¼š' + result.error.message);
      else { clearForm(); loadSongs(); }
    }

    function editSong(id) {
      const song = songs.find(s => s.id === id);
      if (!song) return;
      document.getElementById("songId").value = song.id;
      document.getElementById("songName").value = song.name;
      document.getElementById("songBpm").value = song.bpm;
      document.getElementById("songLang").value = song.lang;
      document.getElementById("songStyle").value = song.style;
    }

    async function deleteSong(id) {
      if (!confirm("ç¢ºå®šè¦åˆªé™¤å—ï¼Ÿ")) return;
      const { error } = await supabaseClient.from('ranked_songs').delete().eq('id', id);
      if (error) alert('åˆªé™¤å¤±æ•—ï¼š' + error.message);
      else loadSongs();
    }

    function clearForm() {
      document.getElementById("songId").value = "";
      document.getElementById("songName").value = "";
      document.getElementById("songBpm").value = "";
      document.getElementById("songLang").value = "ä¸­æ–‡";
      document.getElementById("songStyle").value = "æƒ…æ­Œ";
    }

    function render() {
      const tbody = document.getElementById("songTable");
      tbody.innerHTML = songs.length
        ? songs.map(s => `
          <tr>
            <td>${s.name}</td>
            <td>${s.bpm}</td>
            <td>${s.lang}</td>
            <td>${s.style}</td>
            <td>
              <button onclick="editSong('${s.id}')">âœï¸ ç·¨è¼¯</button>
              <button onclick="deleteSong('${s.id}')">ğŸ—‘ åˆªé™¤</button>
            </td>
          </tr>`).join("")
        : `<tr><td colspan="5">å°šç„¡æ­Œæ›²è³‡æ–™ã€‚</td></tr>`;
    }

    document.getElementById("saveSongBtn").onclick = saveSong;
    document.getElementById("clearFormBtn").onclick = clearForm;

    window.onload = loadSongs;
  </script>
</body>
</html>
